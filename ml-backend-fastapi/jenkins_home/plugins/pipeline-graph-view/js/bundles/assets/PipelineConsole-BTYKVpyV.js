const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DataTreeView-TQHRpp4O.js","./connections-Dcx8uABw.js","./timings-DQC4RGf4.js","./dropdown-C14wRVOb.js","../pipeline-console-view-bundle.js","./StageView-Ux9sVJsn.js","./tree-api-BIb_MB9G.js"])))=>i.map(i=>d[i]);
(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode('.pgv-split-view__container{display:grid;gap:var(--section-padding);animation:fade-in .1s ease-in-out both}@keyframes fade-in{0%{opacity:0}}.pgv-split-view__side-panel{position:relative;min-height:calc(100vh - 250px)}.pgv-split-view__divider{position:absolute;right:calc(var(--section-padding) * -1);top:0;bottom:0;width:var(--section-padding);cursor:col-resize;z-index:1}.pgv-split-view__divider:after{content:"";position:absolute;right:calc(50% - var(--jenkins-border-width, 2px) / 2);top:0;bottom:0;width:var(--jenkins-border-width, 2px);border-radius:5px;transition:var(--standard-transition);background-color:var(--text-color-secondary);opacity:0}.pgv-split-view__divider:hover:after{opacity:.4;scale:150% 100%}.pgv-split-view__divider:active:after{opacity:.8;scale:200% 100%}.ansi-fg-0{color:var(--black, #333)}.ansi-fg-1{color:var(--danger, #cc0003)}.ansi-fg-2{color:var(--success, #138347)}.ansi-fg-3{color:var(--warning, #ea6b19)}.ansi-fg-4{color:var(--primary, #0b6aa2)}.ansi-fg-5{color:var(--unknown-color, #bd0fe1)}.ansi-fg-6{color:var(--paused-color, #24b0d5)}.ansi-fg-7{color:var(--white, #fff)}.ansi-bg-0{background:var(--black, #333)}.ansi-bg-1{background:var(--danger, #cc0003)}.ansi-bg-2{background:var(--success, #138347)}.ansi-bg-3{background:var(--warning, #ea6b19)}.ansi-bg-4{background:var(--primary, #0b6aa2)}.ansi-bg-5{background:var(--unknown-color, #bd0fe1)}.ansi-bg-6{background:var(--paused-color, #24b0d5)}.ansi-bg-7{background:var(--white, #fff)}.pgv-sticky-sidebar{position:sticky;top:calc(var(--header-height) + var(--section-padding))}')),document.head.appendChild(a)}}catch(i){console.error("vite-plugin-css-injected-by-js",i)}})();
import{_ as B}from"../pipeline-console-view-bundle.js";import{r as l,j as g,g as N,e as E,R as _,H as C}from"./connections-Dcx8uABw.js";import{u as k}from"./tree-api-BIb_MB9G.js";function I(i){const[r,c]=l.useState(!1),[o,d]=l.useState(300),u=l.useRef(null),f=m=>{c(!0),m.preventDefault()},p=()=>c(!1),S=m=>{if(r){const v=m.clientX-40;d(Math.max(200,Math.min(v,500)))}};return l.useEffect(()=>(window.addEventListener("mousemove",S),window.addEventListener("mouseup",p),()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",p)})),g.jsxs("div",{className:"pgv-split-view__container",style:{gridTemplateColumns:`${o}px 1fr`},children:[g.jsxs("div",{className:"pgv-split-view__side-panel",children:[i.children[0],g.jsx("div",{ref:u,onMouseDown:f,className:"pgv-split-view__divider"})]}),g.jsx("div",{children:i.children[1]})]})}const P=150*1024,U=1e3;function V(i){const{run:r}=k({currentRunPath:i.currentRunPath,previousRunPath:i.previousRunPath}),[c,o]=l.useState(""),[d,u]=l.useState([]),[f,p]=l.useState([]),[S,m]=l.useState(new Map),[v,R]=l.useState(!1),y=l.useRef([]),h=l.useCallback(async(t,s,e)=>{const n=S.get(t)??{lines:[],startByte:0-P,endByte:-1,stepId:t};if(n.startByte>0&&!s)return;const a=await N(t,e);if(!a)return;const w=a.text.trim().split(`
`)||[];n.endByte>0&&n.endByte<=e?n.lines=[...n.lines,...w]:(n.lines=w,n.startByte=a.startByte),n.endByte=a.endByte,m(M=>new Map(M).set(t,n))},[]),L=l.useCallback(t=>{const s=new URLSearchParams(document.location.search.substring(1));let e=s.get("selected-node");if(!e)return!1;R(!0);const n=t.find(w=>w.id===e),a=[];return n&&(e=n.stageId,a.push(n.id),h(n.id,!1,parseInt(s.get("start-byte")||`${0-P}`))),o(e),u(a),!0},[h]),x=t=>{if(v)return;let s=t.find(e=>e!==void 0);if(!t||t.length===0||!s)return null;for(const e of t){const n=e.state.toLowerCase(),a=s==null?void 0:s.state.toLowerCase();switch(n){case _.running:case _.queued:case _.paused:return e;case _.unstable:case _.failure:case _.aborted:if(a&&n<a)return e;continue;default:a&&n<=a&&(s=e)}}return s};l.useEffect(()=>{E().then(t=>{if(t=t||[],p(t),!L(t)){const e=x(t);e&&(o(e.stageId),e.stageId&&(u(n=>[...n,e.id]),h(e.id,!1,0-P)))}return r!=null&&r.complete||z({getStateUpdateFn:E,onData:e=>{const n=JSON.stringify(y.current)!==JSON.stringify(e);if(v){const a=x(t);a&&(o(a.stageId),a.stageId&&(u(w=>[...w,a.id]),h(a.id,!1,0-P)))}n&&(p(e),y.current=e)},checkComplete:()=>!(r!=null&&r.complete),interval:U}),null}).catch(t=>{console.error("Error in getRunSteps:",t)})},[r==null?void 0:r.stages]);const b=l.useCallback(t=>{if(R(!0),!t||t===c)return;const s=f.filter(a=>a.stageId===t),e=s[s.length-1],n=e?[e.id]:[];o(t),u(a=>[...a,...n]),e&&h(e.id,!1,0-P)},[c,f,h]),j=t=>{R(!0),d.includes(t)?u(s=>s.filter(e=>e!==t)):(u(s=>[...s,t]),h(t,!1,0-P))},O=(t,s)=>{h(t,!0,s)},D=t=>f.filter(s=>s.stageId===t),T=t=>{const s=new Map;return f.forEach(e=>{e.stageId===t&&S.has(e.id)&&s.set(e.id,S.get(e.id))}),s};return{openStage:(()=>{const t=s=>{for(const e of s){if(String(e.id)===c)return e;if(e.children.length>0){const n=t(e.children);if(n)return n}}return null};return c?t((r==null?void 0:r.stages)||[]):null})(),openStageSteps:D(c),openStageStepBuffers:T(c),expandedSteps:d,stages:(r==null?void 0:r.stages)||[],handleStageSelect:b,onStepToggle:j,onMoreConsoleClick:O}}const z=({getStateUpdateFn:i,onData:r,checkComplete:c,interval:o=1e3})=>{let d=!0;return setTimeout(async()=>{for(;d;){const f=await i()||[];if(r(f),c(f)){d=!1;break}await new Promise(p=>setTimeout(p,o))}},o),()=>{d=!1}},A=C.lazy(()=>B(()=>import("./DataTreeView-TQHRpp4O.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),F=C.lazy(()=>B(()=>import("./StageView-Ux9sVJsn.js"),__vite__mapDeps([5,1,2,3,4,6]),import.meta.url));function W(){const i=document.getElementById("console-pipeline-root"),r=i==null?void 0:i.dataset.currentRunPath,c=i==null?void 0:i.dataset.previousRunPath,{openStage:o,openStageSteps:d,openStageStepBuffers:u,expandedSteps:f,stages:p,handleStageSelect:S,onStepToggle:m,onMoreConsoleClick:v}=V({currentRunPath:r,previousRunPath:c});return g.jsxs(I,{children:[g.jsx("div",{id:"tree-view-pane",className:"pgv-sticky-sidebar",children:g.jsx(A,{onNodeSelect:(R,y)=>S(y),selected:o==null?void 0:o.id,stages:p})},"tree-view"),g.jsx("div",{id:"stage-view-pane",children:g.jsx(F,{stage:o,steps:d,stepBuffers:u,expandedSteps:f,onStepToggle:m,onMoreConsoleClick:v})},"stage-view")]})}const G=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{P as L,G as P};
//# sourceMappingURL=PipelineConsole-BTYKVpyV.js.map
