<html layout:decorate="~{layout}">
<th:block layout:fragment="head">
    <title>공고 목록 - 청약핏</title>
</th:block>
<div layout:fragment="content" class="container my-5">
    <!-- Recommendations Section -->
    <div class="page-section" id="recommendations">
        <!-- Summary Box -->
        <div class="summary-box">
            <h3 class="summary-title">
                🎯 내 정보 요약 & 추천 근거
            </h3>
            <div class="summary-grid">
                <div class="summary-item">
                    <h4>🎯 내 정보 요약</h4>
                    <p>29세 / 무주택 / 수도권 거주</p>
                    <small>자산 3.2억원</small>
                </div>
                <div class="summary-item">
                    <h4>🧠 추천 기준</h4>
                    <p>총 23건 추천</p>
                    <small>자산 + 나이 + 거주지 + 무주택 여부 기준</small>
                </div>
                <div class="summary-item">
                    <h4>🏆 가산점 정보</h4>
                    <p>예상 가점: 34점</p>
                    <small>무주택 기간, 부양가족 등 반영</small>
                </div>
                <div class="summary-item">
                    <h4>🔍 현재 필터</h4>
                    <p>서울 / 60㎡ 이상</p>
                    <small>입주 2028년 이전</small>
                </div>
            </div>
            <div class="summary-actions">
                <button onclick="resetFilters()">📌 필터 초기화</button>
                <button onclick="openFilterSettings()">⚙️ 필터 재설정</button>
                <button onclick="updateMyInfo()">📝 내 정보 수정</button>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section" id="filterSection">
            <h3 class="filter-title">
                🔍 상세 필터
            </h3>
            <div class="filter-grid">
                <div class="filter-group">
                    <label for="region">지역</label>
                    <select id="region">
                        <option value="">전체</option>
                        <option value="seoul" selected>서울</option>
                        <option value="gyeonggi">경기</option>
                        <option value="incheon">인천</option>
                        <option value="busan">부산</option>
                        <option value="daegu">대구</option>
                        <option value="other">기타</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="district">구/시</label>
                    <select id="district">
                        <option value="">전체</option>
                        <option value="gangnam">강남구</option>
                        <option value="songpa">송파구</option>
                        <option value="seocho">서초구</option>
                        <option value="mapo">마포구</option>
                        <option value="other">기타</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="area">전용면적</label>
                    <select id="area">
                        <option value="">전체</option>
                        <option value="under60">60㎡ 미만</option>
                        <option value="60to84" selected>60~84㎡</option>
                        <option value="85to100">85~100㎡</option>
                        <option value="over100">100㎡ 초과</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="price">분양가</label>
                    <select id="price">
                        <option value="">전체</option>
                        <option value="under5">5억원 미만</option>
                        <option value="5to7">5~7억원</option>
                        <option value="7to10">7~10억원</option>
                        <option value="over10">10억원 초과</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="moveInDate">입주예정</label>
                    <select id="moveInDate">
                        <option value="">전체</option>
                        <option value="2027" selected>2027년</option>
                        <option value="2028">2028년</option>
                        <option value="2029">2029년</option>
                        <option value="after2030">2030년 이후</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="applicationType">청약유형</label>
                    <select id="applicationType">
                        <option value="">전체</option>
                        <option value="firstTime">생애최초</option>
                        <option value="newlywed">신혼부부</option>
                        <option value="general">일반공급</option>
                        <option value="special">특별공급</option>
                    </select>
                </div>
            </div>
            <div class="filter-actions">
                <button class="btn btn-secondary" onclick="resetFilters()">초기화</button>
                <button class="btn btn-primary" onclick="applyFilters()">필터 적용</button>
            </div>
        </div>

        <div class="recommendations">
            <h2 class="section-title">맞춤 청약 공고</h2>
            <div class="tab-container">
                <button class="tab active" onclick="switchTab(this, 'new')">최신 공고</button>
                <button class="tab" onclick="switchTab(this, 'recommended')">추천 공고</button>
                <button class="tab" onclick="switchTab(this, 'closing')">마감 임박</button>
            </div>

            <div class="map-container">
                <div class="map-sidebar">
                    <div class="property-list-item" onclick="selectProperty(1, this)">
                        <div class="property-header">
                            <div class="property-title">강남 래미안 원베일리</div>
                            <span class="card-badge hot">HOT</span>
                        </div>
                        <div class="property-price">분양가 9억 5천만원</div>
                        <div class="property-details">
                            <span>84㎡</span>
                            <span>강남구</span>
                            <span>6.15 청약</span>
                        </div>
                    </div>

                    <div class="property-list-item" onclick="selectProperty(2, this)">
                        <div class="property-header">
                            <div class="property-title">판교 알파돔시티</div>
                            <span class="card-badge">추천</span>
                        </div>
                        <div class="property-price">분양가 7억 2천만원</div>
                        <div class="property-details">
                            <span>59㎡</span>
                            <span>성남시</span>
                            <span>6.20 청약</span>
                        </div>
                    </div>

                    <div class="property-list-item" onclick="selectProperty(3, this)">
                        <div class="property-header">
                            <div class="property-title">송파 헬리오시티</div>
                            <span class="card-badge">추천</span>
                        </div>
                        <div class="property-price">분양가 8억 8천만원</div>
                        <div class="property-details">
                            <span>74㎡</span>
                            <span>송파구</span>
                            <span>6.18 청약</span>
                        </div>
                    </div>

                    <div class="property-list-item" onclick="selectProperty(4, this)">
                        <div class="property-header">
                            <div class="property-title">마포 래미안 푸르지오</div>
                            <span class="card-badge">신규</span>
                        </div>
                        <div class="property-price">분양가 10억 2천만원</div>
                        <div class="property-details">
                            <span>99㎡</span>
                            <span>마포구</span>
                            <span>6.25 청약</span>
                        </div>
                    </div>
                </div>

                <div class="map-view" id="mapView">
                    <!-- Map markers -->
                    <div class="map-marker" style="top: 60%; left: 65%;" onclick="selectProperty(1)">
                        <span>1</span>
                    </div>
                    <div class="map-marker" style="top: 70%; left: 70%;" onclick="selectProperty(2)">
                        <span>2</span>
                    </div>
                    <div class="map-marker" style="top: 55%; left: 60%;" onclick="selectProperty(3)">
                        <span>3</span>
                    </div>
                    <div class="map-marker" style="top: 45%; left: 45%;" onclick="selectProperty(4)">
                        <span>4</span>
                    </div>

                    <!-- Property detail panel -->
                    <div class="property-detail-panel" id="propertyDetail">
                        <h3 id="detailTitle">강남 래미안 원베일리</h3>
                        <div class="property-details" style="flex-direction: column; gap: 1rem; margin-top: 1rem;">
                            <div class="loan-info-row">
                                <span class="loan-label">분양가</span>
                                <span class="loan-value" id="detailPrice">9억 5천만원</span>
                            </div>
                            <div class="loan-info-row">
                                <span class="loan-label">평형</span>
                                <span class="loan-value" id="detailSize">84㎡ (25평)</span>
                            </div>
                            <div class="loan-info-row">
                                <span class="loan-label">청약일정</span>
                                <span class="loan-value" id="detailDate">2025.06.15</span>
                            </div>
                            <div class="loan-info-row">
                                <span class="loan-label">예상 경쟁률</span>
                                <span class="loan-value" id="detailCompetition">125:1</span>
                            </div>
                            <div class="loan-info-row">
                                <span class="loan-label">입주예정</span>
                                <span class="loan-value" id="detailMoveIn">2028년 3월</span>
                            </div>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;">상세정보 보기</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="script">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Kakao Map API -->
    <script type="text/javascript" th:src="@{|//dapi.kakao.com/v2/maps/sdk.js?appkey=${kakaoApiKey}|}"></script>
    
    <!-- 지도 관련 JavaScript -->
    <script th:inline="javascript">
        // Property selection
        function selectProperty(id, element) {
            // Remove active class from all items
            document.querySelectorAll('.property-list-item').forEach(item => {
                item.classList.remove('active');
            });

            // Add active class to clicked item
            if (element) {
                element.classList.add('active');
            } else {
                // If called from map marker, find the corresponding list item
                document.querySelectorAll('.property-list-item')[id - 1].classList.add('active');
            }

            // Show property detail
            const detailPanel = document.getElementById('propertyDetail');
            detailPanel.classList.add('active');

            // Update detail content based on property ID
            const properties = {
                1: {
                    title: '강남 래미안 원베일리',
                    price: '9억 5천만원',
                    size: '84㎡ (25평)',
                    date: '2025.06.15',
                    competition: '125:1',
                    moveIn: '2028년 3월'
                },
                2: {
                    title: '판교 알파돔시티',
                    price: '7억 2천만원',
                    size: '59㎡ (18평)',
                    date: '2025.06.20',
                    competition: '89:1',
                    moveIn: '2028년 6월'
                },
                3: {
                    title: '송파 헬리오시티',
                    price: '8억 8천만원',
                    size: '74㎡ (22평)',
                    date: '2025.06.18',
                    competition: '156:1',
                    moveIn: '2028년 5월'
                },
                4: {
                    title: '마포 래미안 푸르지오',
                    price: '10억 2천만원',
                    size: '99㎡ (30평)',
                    date: '2025.06.25',
                    competition: '98:1',
                    moveIn: '2028년 8월'
                }
            };

            const property = properties[id];
            document.getElementById('detailTitle').textContent = property.title;
            document.getElementById('detailPrice').textContent = property.price;
            document.getElementById('detailSize').textContent = property.size;
            document.getElementById('detailDate').textContent = property.date;
            document.getElementById('detailCompetition').textContent = property.competition;
            document.getElementById('detailMoveIn').textContent = property.moveIn;
        }

        // Tab switching
        function switchTab(element, tabName) {
            // Remove active class from all tabs
            const tabs = element.parentElement.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Add active class to clicked tab
            element.classList.add('active');

            console.log('Switching to tab:', tabName);
        }
    </script>
</th:block>
</html> 