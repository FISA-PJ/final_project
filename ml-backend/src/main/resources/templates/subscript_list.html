<html layout:decorate="~{layout}">
<div layout:fragment="content" class="container my-3">
    <div class="mb-3">
        <select id="uppAisType" class="form-select" onchange="changeType()" style="width: 200px;">
            <option value="00">전체</option>
            <option value="05" selected>분양주택</option>
            <option value="06">임대주택</option>
            <option value="13">주거복지</option>
            <option value="01">토지</option>
            <option value="22">상가</option>
        </select>
    </div>
    
    <table class="table">
        <thead class="table-dark">
        <tr class="text-center">
            <th>순번</th>
            <th style="width:50%">공고명</th>
            <th>지역</th>
            <th>공고게시일</th>
            <th>공고마감일</th>
            <th>상태</th>
            <th>상세보기</th>
        </tr>
        </thead>
        <tbody>
        <tr class="text-center" th:each="subscript, loop : ${paging}">

            <td th:text="${subscript.RNUM}"></td>
            <td th:text="${subscript.PAN_NM}"></td>
            <td th:text="${subscript.CNP_CD_NM}"></td>
            <td th:text="${subscript.PAN_NT_ST_DT}"></td>
            <td th:text="${subscript.CLSG_DT}"></td>
            <td th:text="${subscript.PAN_SS}"></td>
            <td><a th:href="${subscript.DTL_URL}" th:text="[링크]" target="_blank"></a></td>
        </tr>
        </tbody>
    </table>

    <div th:if="${!paging.isEmpty()}">
        <ul class="pagination justify-content-center">
            <!-- 이전 버튼 -->
            <li class="page-item" th:classappend="${!paging.hasPrevious} ? 'disabled'">
                <a class="page-link" th:href="@{|?page=${paging.number}&type=${selectedType}|}">
                    <span>이전</span>
                </a>
            </li>

            <!-- 첫 페이지 -->
            <li class="page-item" th:classappend="${paging.number == 0} ? 'active'">
                <a class="page-link" th:href="@{|?page=1&type=${selectedType}|}" th:text="1"></a>
            </li>

            <!-- 첫 페이지와 현재 페이지 사이에 간격이 있을 경우 생략 부호 표시 -->
            <li class="page-item disabled" th:if="${paging.number > 3}">
                <a class="page-link">...</a>
            </li>

            <!-- 중간 페이지들 -->
            <li th:each="page: ${#numbers.sequence(1, paging.totalPages)}"
                th:if="${page > 1 && page < paging.totalPages && page >= paging.number-1 && page <= paging.number+3}"
                th:classappend="${page == paging.number+1} ? 'active'" 
                class="page-item">
                <a th:text="${page}" class="page-link" th:href="@{|?page=${page}&type=${selectedType}|}"></a>
            </li>

            <!-- 현재 페이지와 마지막 페이지 사이에 간격이 있을 경우 생략 부호 표시 -->
            <li class="page-item disabled" th:if="${paging.number + 4 < paging.totalPages}">
                <a class="page-link">...</a>
            </li>

            <!-- 마지막 페이지 (총 페이지가 1페이지보다 많을 때만 표시) -->
            <li class="page-item" 
                th:if="${paging.totalPages > 1}"
                th:classappend="${paging.number + 1 == paging.totalPages} ? 'active'">
                <a class="page-link" 
                   th:href="@{|?page=${paging.totalPages}&type=${selectedType}|}" 
                   th:text="${paging.totalPages}"></a>
            </li>

            <!-- 다음 버튼 -->
            <li class="page-item" th:classappend="${!paging.hasNext} ? 'disabled'">
                <a class="page-link" th:href="@{|?page=${paging.number+2}&type=${selectedType}|}">
                    <span>다음</span>
                </a>
            </li>
        </ul>
    </div>

    <script>
        function changeType() {
            const selectedType = document.getElementById('uppAisType').value;
            // 현재 URL에서 파라미터를 가져옴
            const urlParams = new URLSearchParams(window.location.search);
            // type 파라미터 설정
            urlParams.set('type', selectedType);
            // page를 1로 리셋
            urlParams.set('page', '1');
            // 페이지 이동
            window.location.href = '?' + urlParams.toString();
        }

        // 페이지 로드 시 선택된 타입 유지
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const type = urlParams.get('type');
            if (type) {
                document.getElementById('uppAisType').value = type;
            }
        }
    </script>
</div>
</html>

